<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Amazon Lambda</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/guides/amazon-lambda" />
  <meta property="og:title" content="Amazon Lambda" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/amazon-lambda">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Acerca de <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">¿QUE ES QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTENEDOR PRIMERO</a></li>
          <li><a href="/continuum" class="">REACTIVO</a></li>
          <li><a href="/developer-joy" class="">SATISFACCION DEL DESARROLLADOR</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">ESTANDARES</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Aprende <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">EMPEZAR</a></li>
          <li><a href="/guides" class="active">GUIAS</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">LIBROS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SOPORTE</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSIONES</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTOS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="/publications" class="">PUBLICACIONES</a></li>
          <li><a href="/awards" class="">PREMIOS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">Empezar
a codificar</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://ja.quarkus.io/">日本語 - JAPANESE</a></li>
          <li><a href="https://cn.quarkus.io/">简体中文 - CHINESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" selected>2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" >1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Amazon Lambda </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#requisitos-previos">Requisitos previos</a></li>
<li><a href="#cómo-empezar">Cómo empezar</a></li>
<li><a href="#instalación-de-los-bits-de-aws">Instalación de los bits de AWS</a></li>
<li><a href="#creación-del-proyecto-de-implementación-de-maven">Creación del proyecto de implementación de Maven</a></li>
<li><a href="#choose">Elija su lambda</a></li>
<li><a href="#implementar-en-aws-lambda-java-runtime">Implementar en AWS Lambda Java Runtime</a></li>
<li><a href="#construir-y-desplegar">Construir y desplegar</a></li>
<li><a href="#crear-una-función-de-ejecución">Crear una función de ejecución</a></li>
<li><a href="#archivos-extra-generados-por-la-compilación">Archivos extra generados por la compilación</a></li>
<li><a href="#crear-la-función">Crear la función</a></li>
<li><a href="#invocar-la-lambda">Invocar la Lambda</a></li>
<li><a href="#actualizar-la-lambda">Actualizar la Lambda</a></li>
<li><a href="#implementación-en-el-tiempo-de-ejecución-personalizado-nativo-de-aws-lambda">Implementación en el tiempo de ejecución personalizado (nativo) de AWS Lambda</a></li>
<li><a href="#examinar-el-pom-y-la-construcción-de-gradle">Examinar el POM y la construcción de Gradle</a></li>
<li><a href="#gradle">Construcción de Gradle</a></li>
<li><a href="#codificación-en-vivo-y-pruebas-de-unidadintegración">Codificación en vivo y pruebas de unidad/integración</a></li>
<li><a href="#pruebas-con-la-cli-de-sam">Pruebas con la CLI de SAM</a></li>
<li><a href="#modificación-de-function-zip">Modificación de <code>function.zip</code></a></li>
<li><a href="#script-personalizado-de-bootstrap">Script personalizado de <code>bootstrap</code></a></li>
<li><a href="#rastreo-con-aws-xray-y-graalvm">Rastreo con AWS XRay y GraalVM</a></li>
<li><a href="#https">Uso de HTTPS o SSL/TLS</a></li>
<li><a href="#aws-sdk-v2">Uso del SDK de Java de AWS v2</a></li>
<li><a href="#requisitos-adicionales-para-el-ssl-del-cliente">Requisitos adicionales para el SSL del cliente</a></li>
<li><a href="#implementación-en-aws-lambda-mediante-una-imagen-de-contenedor">Implementación en AWS Lambda mediante una imagen de contenedor</a>
<ul class="sectlevel2">
<li><a href="#imagen-del-contenedor-jvm">Imagen del contenedor JVM</a></li>
<li><a href="#imagen-ejecutable-nativa-del-contenedor">Imagen ejecutable nativa del contenedor</a></li>
<li><a href="#despliegue-de-una-imagen-de-contenedor-lambda">Despliegue de una imagen de contenedor lambda</a></li>
</ul>
</li>
<li><a href="#integración-de-amazon-alexa">Integración de Amazon Alexa</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>La extensión <code>quarkus-amazon-lambda</code> le permite utilizar Quarkus para construir sus AWS Lambdas. Tus lambdas pueden utilizar anotaciones de inyección de CDI o Spring y otras facilidades de Quarkus según las necesites.</p>
</div>
<div class="paragraph">
<p>Las lambdas de Quarkus pueden desplegarse utilizando el tiempo de ejecución de Amazon Java, o puedes construir un ejecutable nativo y utilizar el tiempo de ejecución personalizado de Amazon si quieres una huella de memoria más pequeña y un tiempo de arranque en frío más rápido.</p>
</div>
<div class="paragraph">
<p>La integración de Quarkus con las lambdas también es compatible con el ciclo de desarrollo Live Coding de Quarkus. Usted puede traer su proyecto Quarkus lambda en el modo de desarrollo o de prueba y el código en su proyecto en vivo.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requisitos-previos"><a class="anchor" href="#requisitos-previos"></a>Requisitos previos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 30 minutes</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 11+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.8.1+</p>
</li>
<li>
<p>Optionally the <a href="cli-tooling">Quarkus CLI</a> if you want to use it</p>
</li>
<li>
<p>Optionally Mandrel or GraalVM installed and <a href="building-native-image#configuring-graalvm">configured appropriately</a> if you want to build a native executable (or Docker if you use a native container build)</p>
</li>
<li>
<p><a href="https://aws.amazon.com">A Amazon AWS account</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS CLI</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a>, para pruebas locales</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Para los proyectos Gradle, por favor, <a href="#gradle">ver más abajo</a>, o para mayor referencia consulte la guía en <a href="gradle-tooling">Gradle setup page</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cómo-empezar"><a class="anchor" href="#cómo-empezar"></a>Cómo empezar</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Esta guía le guía a través de la generación de un proyecto Java de ejemplo a través de un arquetipo de maven y su implementación en AWS.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="instalación-de-los-bits-de-aws"><a class="anchor" href="#instalación-de-los-bits-de-aws"></a>Instalación de los bits de AWS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instalar todos los bits de AWS es probablemente lo más difícil de esta guía. Asegúrate de seguir todos los pasos para instalar AWS CLI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creación-del-proyecto-de-implementación-de-maven"><a class="anchor" href="#creación-del-proyecto-de-implementación-de-maven"></a>Creación del proyecto de implementación de Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Crea el proyecto maven de Quarkus AWS Lambda utilizando nuestro arquetipo Maven.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn archetype:generate \
       -DarchetypeGroupId=io.quarkus \
       -DarchetypeArtifactId=quarkus-amazon-lambda-archetype \
       -DarchetypeVersion=2.9.2.Final</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si prefieres usar Gradle, puedes generar rápida y fácilmente un proyecto Gradle a través de <a href="https://code.quarkus.io/">code.quarkus.io</a> añadiendo la extensión <code>quarkus-amazon-lambda</code> como dependencia.</p>
</div>
<div class="paragraph">
<p>Copie el build.gradle, gradle.properties y settings.gradle en el proyecto arquetipo de Maven generado anteriormente, para seguir con esta guía.</p>
</div>
<div class="paragraph">
<p>Ejecuta: gradle wrapper para configurar el gradle wrapper (recomendado).</p>
</div>
<div class="paragraph">
<p>Para ver todos los detalles de Gradle <a href="#gradle">ver más abajo</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="choose"><a class="anchor" href="#choose"></a>Elija su lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La extensión <code>quarkus-amazon-lambda</code> busca en tu proyecto una clase que implemente directamente la interfaz de Amazon <code>RequestHandler&lt;?, ?&gt;</code> o <code>RequestStreamHandler</code>. Debe encontrar una clase en tu proyecto que implemente esta interfaz o lanzará un fallo de compilación. Si encuentra más de una clase manejadora, también se lanzará una excepción de tiempo de compilación.</p>
</div>
<div class="paragraph">
<p>A veces, sin embargo, puedes tener unas cuantas lambdas relacionadas que comparten código y crear múltiples módulos de maven es una sobrecarga que no quieres hacer. La extensión <code>quarkus-amazon-lambda</code> te permite agrupar múltiples lambdas en un proyecto y utilizar la configuración o una variable de entorno para elegir el manejador que quieres desplegar.</p>
</div>
<div class="paragraph">
<p>El proyecto generado tiene tres lambdas dentro de él. Dos que implementan la interfaz <code>RequestHandler&lt;?, ?&gt;</code>, y una que implementa la interfaz <code>RequestStreamHandler</code>. Una que se usa y dos que no se usan. Si abres <code>src/main/resources/application.properties</code> verás esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.lambda.handler=test</code></pre>
</div>
</div>
<div class="paragraph">
<p>La propiedad <code>quarkus.lambda.handler</code> indica a Quarkus qué manejador lambda debe desplegar. Esto puede ser anulado con una variable de entorno también.</p>
</div>
<div class="paragraph">
<p>Si miras las tres clases de manejadores generadas en el proyecto, verás que son <code>@Named</code> diferentes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("test")
public class TestLambda implements RequestHandler&lt;InputObject, OutputObject&gt; {
}

@Named("unused")
public class UnusedLambda implements RequestHandler&lt;InputObject, OutputObject&gt; {
}

@Named("stream")
public class StreamLambda implements RequestStreamHandler {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>El nombre CDI de la clase manejadora debe coincidir con el valor especificado en la propiedad <code>quarkus.lambda.handler</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementar-en-aws-lambda-java-runtime"><a class="anchor" href="#implementar-en-aws-lambda-java-runtime"></a>Implementar en AWS Lambda Java Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hay algunos pasos para conseguir que su lambda se ejecute en AWS. El proyecto maven generado contiene un script útil para crear, actualizar, eliminar e invocar sus lambdas para implementaciones puramente Java y nativas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="construir-y-desplegar"><a class="anchor" href="#construir-y-desplegar"></a>Construir y desplegar</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Construye el proyecto:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean package</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto compilará y empaquetará su código.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crear-una-función-de-ejecución"><a class="anchor" href="#crear-una-función-de-ejecución"></a>Crear una función de ejecución</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consulte la <a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-awscli.html">Guía de inicio</a> para implementar un lambda con AWS CLI. Específicamente, asegúrese de haber creado un <code>Execution Role</code>. Tendrá que definir una variable de entorno <code>LAMBDA_ROLE_ARN</code> en su perfil o ventana de consola, alternativamente, puede editar el script <code>manage.sh</code> que es generado por la construcción y poner el valor del rol directamente allí:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="archivos-extra-generados-por-la-compilación"><a class="anchor" href="#archivos-extra-generados-por-la-compilación"></a>Archivos extra generados por la compilación</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Después de ejecutar la construcción, hay algunos archivos adicionales generados por la extensión <code>quarkus-amazon-lambda</code>. Estos archivos están en el directorio de construcción: <code>target/</code> para maven, <code>build/</code> para gradle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>function.zip</code> - archivo de despliegue de lambda</p>
</li>
<li>
<p><code>manage.sh</code> - envoltura alrededor de las llamadas aws lambda cli</p>
</li>
<li>
<p><code>bootstrap-example.sh</code> - ejemplo de secuencia de comandos de arranque para las implantaciones nativas</p>
</li>
<li>
<p><code>sam.jvm.yaml</code> - (opcional) para su uso con sam cli y pruebas locales</p>
</li>
<li>
<p><code>sam.native.yaml</code> - (opcional) para su uso con sam cli y pruebas locales nativas</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crear-la-función"><a class="anchor" href="#crear-la-función"></a>Crear la función</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El script <code>target/manage.sh</code> es para administrar su lambda utilizando el tiempo de ejecución de AWS Lambda Java. Este script se proporciona sólo para su comodidad. Examine la salida del script <code>manage.sh</code> si desea saber qué comandos de aws se ejecutan para crear, eliminar y actualizar sus lambdas.</p>
</div>
<div class="paragraph">
<p><code>manage.sh</code> soporta cuatro operaciones: <code>create</code>, <code>delete</code>, <code>update</code>, y <code>invoke</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Para verificar su configuración, que tiene la CLI de AWS instalada, ha ejecutado aws configure para las claves de acceso de AWS y ha configurado la variable de entorno <code>LAMBDA_ROLE_ARN</code> (como se ha descrito anteriormente), ejecute <code>manage.sh</code> sin ningún parámetro. Se imprimirá una declaración de uso para guiarte en consecuencia.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Si se utiliza Gradle, la ruta de acceso a los binarios en <code>manage.sh</code> debe cambiarse de <code>target</code> a <code>build</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para ver la declaración <code>usage</code>, y validar la configuración de AWS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Puede crear su función utilizando el siguiente comando, <code>create</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh create</code></pre>
</div>
</div>
<div class="paragraph">
<p>o si no tiene <code>LAMBDA_ROLE_ARN</code> ya definido en este shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role" sh target/manage.sh create</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
No cambie el switch del manejador. Esto debe ser codificado en <code>io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest</code>. Este manejador arranca Quarkus y envuelve su manejador real para que la inyección pueda ser realizada.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si hay algún problema en la creación de la función, debe borrarla con la función <code>delete</code> antes de volver a ejecutar el comando <code>create</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los comandos también pueden apilarse:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete create</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="invocar-la-lambda"><a class="anchor" href="#invocar-la-lambda"></a>Invocar la Lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Utilice el comando <code>invoke</code> para invocar su función.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh invoke</code></pre>
</div>
</div>
<div class="paragraph">
<p>La lambda de ejemplo toma la entrada pasada a través del switch <code>--payload</code> que apunta a un archivo json en el directorio raíz del proyecto.</p>
</div>
<div class="paragraph">
<p>La lambda también puede ser invocada localmente con la CLI de SAM de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si está trabajando con su construcción de imagen nativa, simplemente reemplace el nombre de la plantilla con la versión nativa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actualizar-la-lambda"><a class="anchor" href="#actualizar-la-lambda"></a>Actualizar la Lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Puedes actualizar el código Java como creas conveniente. Una vez que hayas reconstruido, puedes volver a desplegar tu lambda ejecutando el comando <code>update</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh update</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementación-en-el-tiempo-de-ejecución-personalizado-nativo-de-aws-lambda"><a class="anchor" href="#implementación-en-el-tiempo-de-ejecución-personalizado-nativo-de-aws-lambda"></a>Implementación en el tiempo de ejecución personalizado (nativo) de AWS Lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si quieres una menor huella de memoria y tiempos de inicialización más rápidos para tu lambda, puedes compilar tu código Java a un ejecutable nativo. Sólo asegúrese de reconstruir su proyecto con el interruptor <code>-Pnative</code>.</p>
</div>
<div class="paragraph">
<p>Para los hosts de Linux, ejecute:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dnative</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.package.type=native</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Si estás construyendo en un sistema que no es Linux, tendrás que pasar también una propiedad que indique a Quarkus que utilice una construcción docker, ya que Amazon Lambda requiere binarios linux. Puedes hacerlo pasando esta propiedad a tu construcción: <code>-Dquarkus.native.container-build=true</code>. Sin embargo, esto requiere que tengas Docker instalado localmente.
</td>
</tr>
</table>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dnative -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.package.type=native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cualquiera de estos comandos compilará y creará una imagen ejecutable nativa. También genera un archivo zip <code>target/function.zip</code>. Este archivo zip contiene su imagen ejecutable nativa renombrada a <code>bootstrap</code>. Este es un requisito del tiempo de ejecución personalizado (proporcionado) de AWS Lambda.</p>
</div>
<div class="paragraph">
<p>Las instrucciones son exactamente las mismas que las anteriores con un cambio: tendrá que añadir <code>native</code> como primer parámetro del script <code>manage.sh</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh native create</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como en el caso anterior, los comandos se pueden apilar. El único requisito es que <code>native</code> sea el primer parámetro si desea trabajar con construcciones de imágenes nativas. El script se encargará del resto de los detalles necesarios para gestionar sus despliegues de funciones de imagen nativa.</p>
</div>
<div class="paragraph">
<p>Examina la salida del script <code>manage.sh</code> si quieres saber qué comandos aws se ejecutan para crear, borrar y actualizar tus lambdas.</p>
</div>
<div class="paragraph">
<p>Una cosa a tener en cuenta sobre el comando de creación para nativos es que la llamada a <code>aws lambda create-function</code> debe establecer una variable de entorno específica:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--environment 'Variables={DISABLE_SIGNAL_HANDLERS=true}'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examinar-el-pom-y-la-construcción-de-gradle"><a class="anchor" href="#examinar-el-pom-y-la-construcción-de-gradle"></a>Examinar el POM y la construcción de Gradle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No hay nada especial en el POM, aparte de la inclusión de la extensión <code>quarkus-amazon-lambda</code> como dependencia. La extensión genera automáticamente todo lo que puedas necesitar para tu despliegue de lambda.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
En versiones anteriores de esta extensión había que configurar el pom o gradle para comprimir el ejecutable para despliegues nativos, pero esto ya no es así.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gradle"><a class="anchor" href="#gradle"></a>Construcción de Gradle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Del mismo modo, para los proyectos de Gradle, también sólo tienes que añadir la dependencia de <code>quarkus-amazon-lambda</code>. La extensión genera automáticamente todo lo que puedas necesitar para el despliegue de tu lambda.</p>
</div>
<div class="paragraph">
<p>Ejemplo de dependencias de Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation enforcedPlatform("${quarkusPlatformGroupId}:${quarkusPlatformArtifactId}:${quarkusPlatformVersion}")
    implementation 'io.quarkus:quarkus-resteasy'
    implementation 'io.quarkus:quarkus-amazon-lambda'

    testImplementation 'io.quarkus:quarkus-junit5'
    testImplementation 'io.rest-assured:rest-assured'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="codificación-en-vivo-y-pruebas-de-unidadintegración"><a class="anchor" href="#codificación-en-vivo-y-pruebas-de-unidadintegración"></a>Codificación en vivo y pruebas de unidad/integración</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para reflejar el entorno de AWS Lambda con la mayor exactitud posible en un entorno de desarrollo, la extensión de Quarkus Amazon Lambda inicia un servidor de eventos de AWS Lambda falso en el modo de desarrollo y prueba de Quarkus. Este servidor de eventos falso simula un verdadero entorno de AWS Lambda.</p>
</div>
<div class="paragraph">
<p>Mientras se ejecuta en el modo de desarrollo de Quarkus, puede alimentar los eventos haciendo un POST HTTP a <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>. El servidor de eventos falso recibirá los eventos y su lambda será invocado. Puedes realizar codificación en vivo en tu lambda y los cambios se recompilarán automáticamente y estarán disponibles en la siguiente invocación que hagas. Aquí tienes un ejemplo:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -d "{\"name\":\"John\"}" -X POST http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para tus pruebas unitarias, también puedes invocar en el servidor de eventos falso usando cualquier cliente HTTP que quieras. Aquí hay un ejemplo usando rest-assured. Quarkus inicia un servidor de eventos simulados separado bajo el puerto 8081. El puerto por defecto para Rest Assured se establece automáticamente a 8081 por Quarkus para que pueda invocar en este punto final.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.junit.jupiter.api.Test;

import io.quarkus.test.junit.QuarkusTest;

import static io.restassured.RestAssured.given;
import static org.hamcrest.CoreMatchers.containsString;

@QuarkusTest
public class LambdaHandlerTest {

    @Test
    public void testSimpleLambdaSuccess() throws Exception {
        Person in = new Person();
        in.setName("Stu");
        given()
                .contentType("application/json")
                .accept("application/json")
                .body(in)
                .when()
                .post()
                .then()
                .statusCode(200)
                .body(containsString("Hello Stu"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>El servidor de eventos simulados también se inicia para las pruebas de <code>@NativeImageTest</code> y <code>@QuarkusIntegrationTest</code>, por lo que también funcionará con binarios nativos. Todo esto proporciona una funcionalidad similar a las pruebas locales de SAM CLI, sin la sobrecarga de Docker.</p>
</div>
<div class="paragraph">
<p>Por último, si el puerto 8080 o el puerto 8081 no están disponibles en su ordenador, puede modificar los puertos en modo dev y test con application.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.lambda.mock-event-server.dev-port=8082
quarkus.lambda.mock-event-server.test-port=8083</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un valor de puerto de cero resultará en un puerto asignado aleatoriamente.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pruebas-con-la-cli-de-sam"><a class="anchor" href="#pruebas-con-la-cli-de-sam"></a>Pruebas con la CLI de SAM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si no quieres utilizar el servidor de eventos simulado, puedes probar tus lambdas con SAM CLI.</p>
</div>
<div class="paragraph">
<p>La <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a> le permite ejecutar sus lambdas localmente en su portátil en un entorno de Lambda simulado. Esto requiere la instalación de <a href="https://www.docker.com/products/docker-desktop">docker</a>. Este es un enfoque opcional en caso de que decidas aprovecharlo. De lo contrario, la integración de Quarkus JUnit debería ser suficiente para la mayoría de sus necesidades.</p>
</div>
<div class="paragraph">
<p>Se ha generado una plantilla de inicio para los modos de ejecución JVM y nativo.</p>
</div>
<div class="paragraph">
<p>Ejecute el siguiente comando CLI de SAM para probar localmente su función lambda, pasando el parámetro apropiado de SAM <code>template</code>. El parámetro <code>event</code> toma cualquier archivo JSON, en este caso el ejemplo <code>payload.json</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Si se utiliza Gradle, la ruta a los binarios en las plantillas YAML debe cambiarse de <code>target</code> a <code>build</code>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>La imagen nativa también puede probarse localmente utilizando la plantilla <code>sam.native.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modificación-de-function-zip"><a class="anchor" href="#modificación-de-function-zip"></a>Modificación de <code>function.zip</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hay veces en las que puedes tener que añadir algunas adiciones al despliegue de lambda <code>function.zip</code> que es generado por la construcción. Para ello crea un directorio <code>zip.jvm</code> o <code>zip.native</code> dentro de <code>src/main</code>. Crea <code>zip.jvm/</code> si estás haciendo una lambda puramente Java. <code>zip.native/</code> si estás haciendo un despliegue nativo.</p>
</div>
<div class="paragraph">
<p>Todos los archivos y directorios que crees bajo tu directorio zip se incluirán dentro de <code>function.zip</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="script-personalizado-de-bootstrap"><a class="anchor" href="#script-personalizado-de-bootstrap"></a>Script personalizado de <code>bootstrap</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hay veces que puedes querer establecer unas propiedades específicas del sistema u otros argumentos cuando lambda invoca tu despliegue lambda nativo de quarkus. Si incluyes un archivo de script <code>bootstrap</code> dentro de <code>zip.native</code>, la extensión quarkus renombrará automáticamente el ejecutable a <code>runner</code> dentro de <code>function.zip</code> y establecerá el modo unix del script <code>bootstrap</code> a ejecutable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
El ejecutable nativo debe ser referenciado como <code>runner</code> si incluye un script personalizado de <code>bootstrap</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La extensión genera un script de ejemplo dentro de <code>target/bootstrap-example.sh</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rastreo-con-aws-xray-y-graalvm"><a class="anchor" href="#rastreo-con-aws-xray-y-graalvm"></a>Rastreo con AWS XRay y GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si estás construyendo imágenes nativas, y quieres usar <a href="https://aws.amazon.com/xray">AWS X-Ray Tracing</a> con tu lambda necesitarás incluir <code>quarkus-amazon-lambda-xray</code> como una dependencia en tu pom. La biblioteca de AWS X-Ray no es totalmente compatible con GraalVM, por lo que hemos tenido que hacer un trabajo de integración para que funcione.</p>
</div>
<div class="paragraph">
<p>Además, recuerde habilitar el parámetro de rastreo de AWS X-Ray en <code>manage.sh</code>, en la función <code>cmd_create()</code>. Esto también se puede configurar en la consola de administración de AWS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">    --tracing-config Mode=Active</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para los archivos de plantilla sam, añada lo siguiente a la función YAML Propiedades.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">    Tracing: Active</code></pre>
</div>
</div>
<div class="paragraph">
<p>AWS X-Ray añade muchas clases a su distribución, asegúrese de que está utilizando al menos el tamaño de memoria de 256 MB de AWS Lambda. Esto se establece explícitamente en <code>manage.sh</code> <code>cmd_create()</code> . Aunque la imagen nativa siempre puede utilizar una configuración de memoria más baja, se recomienda mantener la misma configuración, especialmente para ayudar a comparar el rendimiento.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="https"><a class="anchor" href="#https"></a>Uso de HTTPS o SSL/TLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si tu código hace llamadas HTTPS, como por ejemplo a un microservicio (o servicio AWS), tendrás que añadir la configuración a la imagen nativa, ya que GraalVM sólo incluirá las dependencias cuando se declaren explícitamente. Quarkus, por defecto habilita esta funcionalidad en las extensiones que implícitamente lo requieren. Para más información, consulta la <a href="native-and-ssl">Guía de Quarkus SSL</a></p>
</div>
<div class="paragraph">
<p>Abra src/main/resources/application.properties y añada la siguiente línea para habilitar SSL en su imagen nativa.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.ssl.native=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aws-sdk-v2"><a class="anchor" href="#aws-sdk-v2"></a>Uso del SDK de Java de AWS v2</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Quarkus ahora tiene extensiones para DynamoDB, S3, SNS y SQS (más en camino). Por favor, consulte <a href="{amazon-services-guide}">estas guías</a> sobre cómo utilizar los diversos servicios de AWS con Quarkus, en lugar de cablear manualmente como se indica a continuación.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con una integración mínima, es posible aprovechar el AWS Java SDK v2, que puede utilizarse para invocar servicios como SQS, SNS, S3 y DynamoDB.</p>
</div>
<div class="paragraph">
<p>Para la imagen nativa, sin embargo, se debe preferir el cliente de Conexión URL sobre el Cliente HTTP de Apache cuando se utiliza el modo síncrono, debido a problemas en la compilación de GraalVM (en la actualidad).</p>
</div>
<div class="paragraph">
<p>Añade <code>quarkus-jaxb</code> como dependencia en tu archivo Maven <code>pom.xml</code>, o Gradle <code>build.gradle</code>.</p>
</div>
<div class="paragraph">
<p>También debe forzar a su cliente de servicios de AWS para SQS, SNS, S3 y otros, a utilizar el cliente de Conexión URL, que se conecta a los servicios de AWS a través de HTTPS, de ahí la inclusión de la propiedad SSL enabled, como se describe en la sección <a href="#https">Uso de HTTPS o SSL/TLS</a> anterior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// select the appropriate client, in this case SQS, and
// insert your region, instead of XXXX, which also improves startup time over the default client
  client = SqsClient.builder().region(Region.XXXX).httpClient(software.amazon.awssdk.http.urlconnection.UrlConnectionHttpClient.builder().build()).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para Maven, añada lo siguiente a su <code>pom.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;properties&gt;
        &lt;aws.sdk2.version&gt;2.10.69&lt;/aws.sdk2.version&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;

            &lt;dependency&gt;
                &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                &lt;artifactId&gt;bom&lt;/artifactId&gt;
                &lt;version&gt;${aws.sdk2.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;

        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;artifactId&gt;url-connection-client&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;artifactId&gt;apache-client&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;commons-logging&lt;/groupId&gt;
                    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;!-- sqs/sns/s3 etc --&gt;
            &lt;artifactId&gt;sqs&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;!-- exclude the apache-client and netty client --&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                    &lt;artifactId&gt;apache-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                    &lt;artifactId&gt;netty-nio-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;commons-logging&lt;/groupId&gt;
                    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging-jboss-logging&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
si ves <code>java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty</code> o un error SSL similar, debido al estado actual de GraalVM, hay algo de trabajo adicional para agrupar el <code>function.zip</code>, como se indica a continuación. Para más información, por favor vea la <a href="native-and-ssl.html">Guía de SSL nativa de Quarkus</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requisitos-adicionales-para-el-ssl-del-cliente"><a class="anchor" href="#requisitos-adicionales-para-el-ssl-del-cliente"></a>Requisitos adicionales para el SSL del cliente</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El ejecutable nativo requiere algunos pasos adicionales para habilitar el SSL del cliente que necesitan S3 y otras bibliotecas de AWS.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Un script personalizado de <code>bootstrap</code></p>
</li>
<li>
<p><code>libsunec.so</code> debe añadirse a <code>function.zip</code></p>
</li>
<li>
<p><code>cacerts</code> debe añadirse a <code>function.zip</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para ello, primero cree un directorio <code>src/main/zip.native/</code> con su construcción. A continuación, cree un archivo de secuencia de comandos llamado <code>bootstrap</code> dentro de <code>src/main/zip.native/</code>, como se indica a continuación. Un ejemplo es crear automáticamente en su carpeta de construcción (target o build), llamado <code>bootstrap-example.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

./runner -Djava.library.path=./ -Djavax.net.ssl.trustStore=./cacerts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conjunto adicional <code>-Djavax.net.ssl.trustStorePassword=changeit</code> si su archivo <code>cacerts</code> está protegido por contraseña.</p>
</div>
<div class="paragraph">
<p>A continuación debes copiar algunos archivos de tu distribución de GraalVM en <code>src/main/zip.native/</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Las versiones de GraalVM pueden tener diferentes rutas para estos archivos, y si se utiliza la versión de Java 8 o 11. Ajústalo en consecuencia.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp $GRAALVM_HOME/lib/libsunec.so $PROJECT_DIR/src/main/zip.native/
cp $GRAALVM_HOME/lib/security/cacerts $PROJECT_DIR/src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora, cuando ejecute la compilación nativa, todos estos archivos se incluirán en <code>function.zip</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Si está utilizando una imagen Docker para construir, entonces debe extraer estos archivos de esta imagen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para extraer el ssl necesario, debe iniciar un contenedor Docker en segundo plano, y adjuntar a ese contenedor para copiar los artefactos.</p>
</div>
<div class="paragraph">
<p>En primer lugar, vamos a iniciar el contenedor GraalVM, observando la salida del id del contenedor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it -d --entrypoint bash quay.io/quarkus/ubi-quarkus-native-image:22.0-java11

# This will output a container id, like 6304eea6179522aff69acb38eca90bedfd4b970a5475aa37ccda3585bc2abdde
# Note this value as we will need it for the commands below</code></pre>
</div>
</div>
<div class="paragraph">
<p>En primer lugar, libsunec.so, la biblioteca C utilizada para la implementación de SSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker cp {container-id-from-above}:/opt/graalvm/lib/libsunec.so src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>En segundo lugar, cacerts, el almacén de certificados. Es posible que tenga que obtener periódicamente una copia actualizada, también.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker cp {container-id-from-above}:/opt/graalvm/lib/security/cacerts src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Su archivo final tendrá este aspecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">jar tvf target/function.zip

    bootstrap
    runner
    cacerts
    libsunec.so</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementación-en-aws-lambda-mediante-una-imagen-de-contenedor"><a class="anchor" href="#implementación-en-aws-lambda-mediante-una-imagen-de-contenedor"></a>Implementación en AWS Lambda mediante una imagen de contenedor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWS Lambda admite la creación de sus lambdas haciendo referencia a <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-images.html">imágenes de contenedores</a> en lugar de cargar archivos ZIP. Esto puede tener algunas ventajas, como evitar el límite de tamaño de los archivos ZIP cargados. Puede definir funciones lambda tanto para compilaciones nativas como para compilaciones JVM normales.</p>
</div>
<div class="sect2">
<h3 id="imagen-del-contenedor-jvm"><a class="anchor" href="#imagen-del-contenedor-jvm"></a>Imagen del contenedor JVM</h3>
<div class="paragraph">
<p>Para una distribución regular de JVM necesitas basar tu imagen en las imágenes base oficiales de AWS Java. A continuación se muestra un ejemplo de un archivo Docker que crearía una imagen de contenedor de su proyecto Quarkus Lambda. Asume que <code>mvn package</code> ha sido ejecutado y los binarios están disponibles en el directorio <code>target/</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Dockerfile hljs" data-lang="Dockerfile">FROM  public.ecr.aws/lambda/java:11

ADD target/my-service-0.0.1-SNAPSHOT-runner.jar /var/task/lib/my-service.jar
ADD target/lib/  /var/task/lib/

CMD ["io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest"]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="imagen-ejecutable-nativa-del-contenedor"><a class="anchor" href="#imagen-ejecutable-nativa-del-contenedor"></a>Imagen ejecutable nativa del contenedor</h3>
<div class="paragraph">
<p>Para crear una imagen de contenedor lambda que utilice el ejecutable nativo tendremos que hacer las cosas de forma un poco diferente. En este caso, no necesitaremos utilizar la imagen base de <code>java:11</code> de AWS, sino que utilizaremos una imagen especial que asume que se proporciona el entorno de ejecución para lambda. El siguiente ejemplo crea un contenedor de este tipo. Asume que se ha ejecutado una construcción de Maven (como <code>mvn package -Dnative=true</code>) y ha generado el binario nativo en el directorio <code>target/</code>. El binario necesita ser llamado <code>bootstrap</code> y ser colocado en <code>/var/runtime/</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Dockerfile hljs" data-lang="Dockerfile">FROM  public.ecr.aws/lambda/provided

ADD target/my-service-0.0.1-SNAPSHOT-runner /var/runtime/bootstrap
RUN chmod ugo+x /var/runtime/bootstrap

CMD ["io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest"]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="despliegue-de-una-imagen-de-contenedor-lambda"><a class="anchor" href="#despliegue-de-una-imagen-de-contenedor-lambda"></a>Despliegue de una imagen de contenedor lambda</h3>
<div class="paragraph">
<p>A continuación, puede ver cómo las imágenes de contenedor creadas anteriormente pueden construirse e implementarse en AWS utilizando las herramientas de línea de comandos <code>docker</code> y <code>aws</code>. Estas instrucciones funcionan tanto para imágenes de contenedor nativas como jvm y asumen que la herramienta de línea de comandos <code>aws</code> ha sido iniciada.</p>
</div>
<div class="sect3">
<h4 id="construir-la-imagen-docker"><a class="anchor" href="#construir-la-imagen-docker"></a>Construir la imagen Docker</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Assuming we are located in the root directory of the project and created a Dockerfile there
docker build .
   [output omitted]
    =&gt; exporting to image                    0.0s
    =&gt; =&gt; exporting layers                   0.0s
    =&gt; =&gt; writing image sha256:[SOME SHA]    0.0s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="crear-un-repositorio-ecr-en-la-cuenta-aws-del-usuario"><a class="anchor" href="#crear-un-repositorio-ecr-en-la-cuenta-aws-del-usuario"></a>Crear un repositorio ECR en la cuenta AWS del usuario</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws ecr create-repository --repository-name my/test/quarkus-lambda</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="etiquetar-la-imagen-con-la-información-de-su-registro-ecr"><a class="anchor" href="#etiquetar-la-imagen-con-la-información-de-su-registro-ecr"></a>Etiquetar la imagen con la información de su registro ECR</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker tag [SOME SHA] [YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com/my/test/quarkus-lambda:v1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="registre-docker-en-su-registro-ecr-y-empuje-la-imagen-docker-a-él"><a class="anchor" href="#registre-docker-en-su-registro-ecr-y-empuje-la-imagen-docker-a-él"></a>Registre Docker en su registro ECR y empuje la imagen Docker a él</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws ecr get-login-password --region region | docker login --username AWS --password-stdin [YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com
docker push [YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com/my/test/quarkus-lambda:v1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="crear-la-función-aws-lambda-con-la-herramienta-aws-cli"><a class="anchor" href="#crear-la-función-aws-lambda-con-la-herramienta-aws-cli"></a>Crear la función AWS lambda con la herramienta AWS CLI</h4>
<div class="paragraph">
<p>Asegúrate de que haces referencia a la imagen que has subido previamente (se supone que existe un rol que puede ser utilizado para ejecutar la lambda). Ten en cuenta que no es improbable que para la función lambda de JVM, el límite de memoria por defecto de <code>128Mb</code> no sea suficiente para ejecutar la función. En ese caso, puede aumentar el límite de memoria al crear la función proporcionando el parámetro <code>--memory-size 256</code> a su comando <code>aws lambda create-function</code>. También puede ajustar la función en la consola de AWS después de haberla creado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws lambda create-function --function-name my-test-quarkus-lambda-function --package-type Image --code ImageUri=[YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com/my/test/quarkus-lambda:v1 --role arn:aws:iam::[YOUR AWS ACCOUNT ID]:role/[SOME ROLE]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora puedes usar la consola de AWS para ver y probar tu nueva función lambda.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integración-de-amazon-alexa"><a class="anchor" href="#integración-de-amazon-alexa"></a>Integración de Amazon Alexa</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para utilizar Alexa con Quarkus nativo, es necesario utilizar la <a href="https://github.com/quarkiverse/quarkus-amazon-alexa">extensión Quarkus Amazon Alexa alojada en el Quarkiverse Hub</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkiverse.alexa&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-amazon-alexa&lt;/artifactId&gt;
    &lt;version&gt;${quarkus-amazon-alexa.version}&lt;/version&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defina la última versión de la extensión en su archivo POM.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Crea tu manejador de Alexa, como es normal, usando una sub-clase abstracta de <code>com.amazon.ask.SkillStreamHandler</code>, y añade la implementación de tu manejador de peticiones.</p>
</div>
<div class="paragraph">
<p>Eso es todo!</p>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. Todas las dependencias de este proyecto están disponible bajo la <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Licencia Apache Software 2.0</a> o una licencia compatible.<br /><br />Este sitio web fue construido con <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, está alojado en <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> y es completamente de código abierto. Si quieres mejorarlo, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>crea un fork de la página web</a> y muéstranos lo que tienes.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/about">Acerca&nbsp;de</a></li>
          
            <li><a href="/blog">Blog</a></li>
          
            <li><a href="/insights">Podcast</a></li>
          
            <li><a href="/events">Eventos</a></li>
          
            <li><a href="/newsletter">Newsletter</a></li>
          
            <li><a href="/publications">Publicaciones</a></li>
          
            <li><a href="/awards">Premios</a></li>
          
            <li><a href="/security">Política&nbsp;de&nbsp;seguridad</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Síguenos</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Obtener ayuda</span>
        <ul class="footer-links">
          
            <li><a href="/support">Soporte</a></li>
          
            <li><a href="/guides">Guías</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">Introducción</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">Discusiones</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Lista de correo de desarrollo</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus está hecho a base de proyectos comunitarios</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">Y muchos más...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
