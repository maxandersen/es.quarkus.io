<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Vinculación de los eventos de Funqy Knative</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/guides/funqy-knative-events" />
  <meta property="og:title" content="Vinculación de los eventos de Funqy Knative" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/funqy-knative-events">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Acerca de <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">¿QUE ES QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTENEDOR PRIMERO</a></li>
          <li><a href="/continuum" class="">REACTIVO</a></li>
          <li><a href="/developer-joy" class="">SATISFACCION DEL DESARROLLADOR</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">ESTANDARES</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Aprende <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">EMPEZAR</a></li>
          <li><a href="/guides" class="active">GUIAS</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">LIBROS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SOPORTE</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSIONES</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTOS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="/publications" class="">PUBLICACIONES</a></li>
          <li><a href="/awards" class="">PREMIOS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">Empezar
a codificar</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://ja.quarkus.io/">日本語 - JAPANESE</a></li>
          <li><a href="https://cn.quarkus.io/">简体中文 - CHINESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" selected>2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" >1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Vinculación de los eventos de Funqy Knative </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#requisitos-previos">Requisitos previos</a></li>
<li><a href="#configuración-de-knative">Configuración de Knative</a></li>
<li><a href="#lea-sobre-los-eventos-en-la-nube">Lea sobre los eventos en la nube</a></li>
<li><a href="#el-inicio-rápido">El inicio rápido</a></li>
<li><a href="#el-flujo-de-inicio-rápido">El flujo de inicio rápido</a></li>
<li><a href="#eventos-de-funqy-y-cloud">Eventos de Funqy y Cloud</a></li>
<li><a href="#el-código">El Código</a></li>
<li><a href="#maven">Maven</a></li>
<li><a href="#modo-de-desarrollo-y-pruebas">Modo de desarrollo y pruebas</a></li>
<li><a href="#construir-el-proyecto">Construir el proyecto</a></li>
<li><a href="#despliegue-en-kubernetesopenshift">Despliegue en Kubernetes/OpenShift</a></li>
<li><a href="#ejecutar-la-demo">Ejecutar la demo</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus Funqy <a href="https://knative.dev/docs/eventing">Knative Events</a> se basa en la extensión <a href="funqy-http.html">Funqy HTTP</a> para permitirle enrutar y procesar Knative Events dentro de una función Funqy.</p>
</div>
<div class="paragraph">
<p>La guía recorre el código de inicio rápido para mostrarte cómo puedes desplegar e invocar en funciones Funqy con Knative Events.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requisitos-previos"><a class="anchor" href="#requisitos-previos"></a>Requisitos previos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 1 hour</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 11+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.8.1+</p>
</li>
<li>
<p>Optionally the <a href="cli-tooling">Quarkus CLI</a> if you want to use it</p>
</li>
<li>
<p>Lea sobre <a href="funqy.html">los fundamentos de Funqy</a>. Esta es una lectura corta!</p>
</li>
<li>
<p>Have gone through the <a href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial/index.html">Knative Tutorial</a>, specifically <a href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial/eventing/eventing-trigger-broker.html">Brokers and Triggers</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuración-de-knative"><a class="anchor" href="#configuración-de-knative"></a>Configuración de Knative</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configurar Knative localmente en un entorno Minikube está más allá del alcance de esta guía. Se recomienda seguir <a href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial/index.html">este</a> tutorial de Knative elaborado por Red Hat. Se trata de cómo configurar Knative en Minikube u OpenShift en un entorno local.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Specifically you should run the <a href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial/eventing/eventing-trigger-broker.html">Brokers and Triggers</a> tutorial as this guide requires that you can invoke on a Broker to trigger the quickstart code.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lea-sobre-los-eventos-en-la-nube"><a class="anchor" href="#lea-sobre-los-eventos-en-la-nube"></a>Lea sobre los eventos en la nube</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La <a href="https://cloudevents.io/">especificación de</a> los eventos en la nube es una buena lectura para que comprenda mejor los eventos de Knative.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="el-inicio-rápido"><a class="anchor" href="#el-inicio-rápido"></a>El inicio rápido</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clone el repositorio Git: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> o descargue un <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">archivo</a>.</p>
</div>
<div class="paragraph">
<p>La solución se encuentra en <code>funqy-knative-events-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-knative-events-quickstart">directorio</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="el-flujo-de-inicio-rápido"><a class="anchor" href="#el-flujo-de-inicio-rápido"></a>El flujo de inicio rápido</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El quickstart funciona enviando manualmente una petición HTTP que contiene un Cloud Event al Knative Broker usando <code>curl</code>. El Broker Knative recibe la petición y desencadena el inicio del contenedor Funqy construido por el quickstart. El evento desencadena la invocación de una cadena de funciones Funqy. La salida de una función desencadena la invocación de otra función Funqy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eventos-de-funqy-y-cloud"><a class="anchor" href="#eventos-de-funqy-y-cloud"></a>Eventos de Funqy y Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cuando viven dentro de un entorno de Knative Events, las funciones de Funqy son activadas por un tipo de Evento de la Nube específico. Puede tener múltiples funciones Funqy dentro de una sola aplicación/despliegue, pero deben ser activadas por un Tipo de Evento de la Nube específico. La excepción a esta regla es si sólo hay una función Funqy en la aplicación. En ese caso, el evento es empujado a esa función independientemente del tipo de Evento en la Nube.</p>
</div>
<div class="paragraph">
<p>Actualmente, Funqy sólo puede consumir datos basados en JSON. Soporta tanto el modo de ejecución Binario como el Estructurado, pero el componente de datos del mensaje de Evento en la Nube debe ser JSON. Este JSON también debe ser marshallable hacia y desde los parámetros Java y los tipos de retorno de sus funciones.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="el-código"><a class="anchor" href="#el-código"></a>El Código</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Empecemos a ver nuestro código de inicio rápido para que puedas entender cómo los eventos Knative se asignan a Funqy. Abre <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-knative-events-quickstart/src/main/java/org/acme/funqy/SimpleFunctionChain.java">SimpleFunctionChain.java</a>.</p>
</div>
<div class="paragraph">
<p>La primera función que veremos es <code>defaultChain</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.funqy.Funq;

public class SimpleFunctionChain {
    @Funq
    public String defaultChain(String input) {
        log.info("*** defaultChain ***");
        return input + "::" + "defaultChain";
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tal y como está, una función Funqy tiene un mapeo de Eventos en la Nube por defecto. Por defecto, el tipo de Cloud Event debe coincidir con el nombre de la función para que esta se active. Si la función devuelve una salida, la respuesta se convierte en un Evento en la Nube y se devuelve al Broker para que se dirija a otros activadores. El tipo de evento en la nube por defecto para esta respuesta es el nombre de la función + <code>.output</code>. La fuente de eventos en la nube por defecto es el nombre de la función.</p>
</div>
<div class="paragraph">
<p>Así, para la función <code>defaultChain</code>, el tipo de Evento en la Nube que desencadena la función es <code>defaultChain</code>. Genera una respuesta que desencadena un nuevo Evento en la Nube cuyo tipo es <code>defaultChain.output</code> y el origen del evento es <code>defaultChain</code>.</p>
</div>
<div class="paragraph">
<p>Aunque la asignación por defecto es sencilla, puede que no siempre sea factible. Puedes cambiar esta asignación por defecto a través de la configuración. Veamos la siguiente función:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.funqy.Funq;

public class SimpleFunctionChain {
    @Funq
    public String configChain(String input) {
        log.info("*** configChain ***");
        return input + "::" + "configChain";
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>La función <code>configChain</code> tiene su mapeo de eventos en la nube cambiado por la configuración dentro de <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-knative-events-quickstart/src/main/resources/application.properties">application.properties</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.funqy.knative-events.mapping.configChain.trigger=defaultChain.output
quarkus.funqy.knative-events.mapping.configChain.response-type=annotated
quarkus.funqy.knative-events.mapping.configChain.response-source=configChain</code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, la configuración asigna el tipo de evento en la nube entrante <code>defaultChain.output</code> a la función <code>configChain</code>. La función <code>configChain</code> asigna su respuesta al tipo de Evento en la Nube <code>annotated</code>, y la fuente de Evento en la Nube <code>configChain</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.funqy.knative-events.mapping.{function name}.trigger</code> establece el tipo de Evento de Nube que desencadena una función específica. Es posible utilizar el valor especial <code>*</code> como valor general. En este caso, la función se utilizará para todos los tipos de eventos.</p>
</li>
<li>
<p><code>quarkus.funqy.knative-events.mapping.{function name}.response-type</code> establece el tipo de evento de nube de la respuesta</p>
</li>
<li>
<p><code>quarkus.funqy.knative-events.mapping.{function name}.resource-source</code> establece la fuente de eventos de la nube de la respuesta</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La extensión Funqy Knative Events también tiene anotaciones para hacer este mapeo de Cloud Event a sus funciones. Echa un vistazo al método <code>annotatedChain</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.funqy.Funq;
import io.quarkus.funqy.knative.events.CloudEventMapping;

public class SimpleFunctionChain {
    @Funq
    @CloudEventMapping(trigger = "annotated", responseSource = "annotated", responseType = "lastChainLink")
    public String annotatedChain(String input) {
        log.info("*** annotatedChain ***");
        return input + "::" + "annotatedChain";
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si utilizas la anotación <code>@CloudEventMapping</code> en tu función, puedes asignar el desencadenamiento del tipo de Evento en la Nube y la respuesta del Evento en la Nube. En este ejemplo, la función <code>annotatedChain</code> será activada por el tipo de evento en la nube <code>annotated</code> y la respuesta se asignará a un tipo <code>lastChainLink</code> y a una fuente de evento en la nube <code>annotated</code>.</p>
</div>
<div class="paragraph">
<p>Así pues, si observamos todas las funciones definidas en <code>SimpleFunctionChain</code> nos daremos cuenta de que una función desencadena la siguiente. La última función que se activa es <code>lastChainLink</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.funqy.Context;
import io.quarkus.funqy.Funq;

public class SimpleFunctionChain {
    @Funq
    public void lastChainLink(String input, @Context CloudEvent event) {
        log.info("*** lastChainLink ***");
        log.info(input + "::" + "lastChainLink");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hay dos cosas que hay que tener en cuenta sobre esta función. Una, no tiene salida. Sus funciones no están obligadas a devolver salida. Segundo, hay un parámetro adicional <code>event</code> a la función.</p>
</div>
<div class="paragraph">
<p>Si desea conocer información adicional sobre el evento entrante de la nube, puede inyectar la interfaz <code>io.quarkus.funqy.knative.events.CloudEvent</code> utilizando la anotación Funqy <code>@Context</code>. La interfaz <code>CloudEvent</code> expone información sobre el evento desencadenante.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface CloudEvent {
    String id();
    String specVersion();
    String source();
    String subject();
    OffsetDateTime time();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maven"><a class="anchor" href="#maven"></a>Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si miras el <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-knative-events-quickstart/pom.xml">POM</a>, verás que es un típico POM de Quarkus que trae una dependencia de Funqy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-funqy-knative-events&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modo-de-desarrollo-y-pruebas"><a class="anchor" href="#modo-de-desarrollo-y-pruebas"></a>Modo de desarrollo y pruebas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Funqy Knative Events soporta el modo dev y las pruebas unitarias utilizando RestAssured. Puede invocar en las funciones de Funqy Knative Events usando el mismo modelo de invocación que <a href="funqy-http.html">Funqy HTTP</a> usando peticiones HTTP normales, o el modo binario de Cloud Event, o el modo estructurado. Todos los modos de invocación están soportados al mismo tiempo.</p>
</div>
<div class="paragraph">
<p>Así, si abres el código de la prueba unitaria en <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-knative-events-quickstart/src/test/java/org/acme/funqy/FunqyTest.java">FunqyTest.java</a> verás que simplemente utiliza RestAssured para hacer invocaciones HTTP para probar las funciones.</p>
</div>
<div class="paragraph">
<p>¡Funqy también funciona con el modo Quarkus Dev!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="construir-el-proyecto"><a class="anchor" href="#construir-el-proyecto"></a>Construir el proyecto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Primero construya los artefactos Java:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean package</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, Knative necesita una imagen docker, así que tendrás que construirla:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker build -f src/main/docker/Dockerfile.jvm -t yourAccountName/funqy-knative-events-quickstart .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Asegúrese de reemplazar <code>yourAccountName</code> con su nombre de cuenta docker o quay cuando ejecute <code>docker build</code>. El Dockerfile es un dockerfile estándar de Quarkus. No hay magia especial de Knative.</p>
</div>
<div class="paragraph">
<p>Envíe su imagen a docker hub o quay</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker push yourAccountName/funqy-knative-events-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>De nuevo, asegúrese de sustituir <code>yourAccountName</code> por el nombre de su cuenta docker o quay cuando ejecute <code>docker push</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="despliegue-en-kubernetesopenshift"><a class="anchor" href="#despliegue-en-kubernetesopenshift"></a>Despliegue en Kubernetes/OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El primer paso es configurar el broker en nuestro espacio de nombres. A continuación se muestra un ejemplo de comando desde el cli de Knative.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kn broker create default \
  --namespace knativetutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>El broker que hemos creado se llama <code>default</code>, este broker recibirá los eventos de la nube. El broker también está referenciado en los archivos YAML de la función.</p>
</div>
<div class="paragraph">
<p>El segundo paso es definir un servicio Kubernetes/OpenShift que apunte a la imagen Docker que creaste y empujaste durante la construcción. Echa un vistazo a <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-knative-events-quickstart/src/main/k8s/funqy-service.yaml">funqy-service.yaml</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: funqy-knative-events-quickstart
spec:
  template:
    metadata:
      name: funqy-knative-events-quickstart-v1
      annotations:
        autoscaling.knative.dev/target: "1"
    spec:
      containers:
        - image: docker.io/yourAccountName/funqy-knative-events-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se trata de un archivo YAML estándar de definición de servicios de Kubernetes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Asegúrate de cambiar la URL de la imagen para que apunte a la imagen que construiste y subiste antes!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para nuestro inicio rápido, un servicio de Kubernetes contendrá todas las funciones. No hay ninguna razón por la que no se pueda dividir este inicio rápido en varios proyectos diferentes y desplegar un servicio para cada función. Para simplificar, y para mostrar que no es necesario tener un despliegue por función, el inicio rápido combina todo en un proyecto, imagen y servicio.</p>
</div>
<div class="paragraph">
<p>Despliegue el servicio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f src/main/k8s/funqy-service.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>El siguiente paso es desplegar los activadores de Knative Event para cada uno de los tipos de eventos. Como se ha indicado en la sección de código, cada función de Funqy se asigna a un tipo de evento de la nube específico. Debes crear desencadenantes Knative Event que mapeen un Cloud Event y lo dirijan a un servicio Kubernetes específico. Tenemos 4 disparadores diferentes.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-knative-events-quickstart/src/main/k8s/defaultChain-trigger.yaml">defaultChain-trigger.yaml</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: eventing.knative.dev/v1alpha1
kind: Trigger
metadata:
  name: defaultchain
spec:
  broker: default
  filter:
    attributes:
      type: defaultChain
  subscriber:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: funqy-knative-events-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>spec:filter:attributes:type</code> asigna un tipo de evento de nube al servicio de Kubernetes definido en <code>spec:subscriber:ref</code>. Cuando se envía un evento de la nube al corredor, se activará el giro del servicio asignado a ese evento.</p>
</div>
<div class="paragraph">
<p>Hay un archivo YAML de activación para cada una de nuestras 4 funciones Funqy. Despliégalos todos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f src/main/k8s/defaultChain-trigger.yaml
kubectl apply -n knativetutorial -f src/main/k8s/configChain-trigger.yaml
kubectl apply -n knativetutorial -f src/main/k8s/annotatedChain-trigger.yaml
kubectl apply -n knativetutorial -f src/main/k8s/lastChainLink-trigger.yaml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ejecutar-la-demo"><a class="anchor" href="#ejecutar-la-demo"></a>Ejecutar la demo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Necesitará dos ventanas de terminal diferentes. Una para hacer una petición curl al Broker, la otra para ver los archivos de registro del pod y así poder ver los mensajes que fluyen a través de la cadena de eventos de la función Funqy.</p>
</div>
<div class="paragraph">
<p>Asegúrese de que tiene instalada la herramienta <code>stern</code>. Consulta la configuración del Tutorial Knative para obtener información al respecto. Ejecuta stern para buscar los registros emitidos por nuestro despliegue de Funqy</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stern funq user-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>Abra un terminal independiente. Primero tendrás que conocer la URL del broker. Ejecuta este comando para encontrarlo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get broker default -o jsonpath='{.status.address.url}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto le proporcionará una URL similar a, por ejemplo <code><a href="http://broker-ingress.knative-eventing.svc.cluster.local/knativetutorial/default" class="bare">http://broker-ingress.knative-eventing.svc.cluster.local/knativetutorial/default</a></code>. Recuerde esta URL.</p>
</div>
<div class="paragraph">
<p>Lo siguiente que tenemos que hacer es ssh en nuestro clúster Kubernetes para que podamos enviar una solicitud curl a nuestro broker. El siguiente comando creará un simple pod OS para que podamos curl en nuestras funciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial apply -f src/main/k8s/curler.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Puede que tengas que esperar un par de segundos hasta que aparezca el pod. Ejecute lo siguiente para obtener acceso bash al pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial exec -it curler -- /bin/bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora estarás en un shell dentro del cluster de Kubernetes. Dentro del shell, ejecute este comando curl , la dirección del broker es un ejemplo y puede diferir según el nombre de su proyecto o broker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -v "http://default-broker.knativetutorial.svc.cluster.local" \
-X POST \
-H "Ce-Id: 1234" \
-H "Ce-Specversion: 1.0" \
-H "Ce-Type: defaultChain" \
-H "Ce-Source: curl" \
-H "Content-Type: application/json" \
-d '"Start"'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto envía un Evento Knative al broker, que activará la función <code>defaultChain</code>. Como se ha comentado anteriormente, la salida de <code>defaultChain</code> desencadena un evento que se publica en <code>configChain</code>, que desencadena un evento publicado en <code>annotatedChain</code> y finalmente en la función <code>lastChainLink</code>. Puede ver este flujo en su ventana <code>stern</code>. Algo como esto debería salir.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">funqy-knative-events-quickstart-v1-deployment-59bb88bcf4-9jwdx user-container 2020-05-12 13:44:02,256 INFO  [org.acm.fun.SimpleFunctionChain] (executor-thread-1) *** defaultChain ***
funqy-knative-events-quickstart-v1-deployment-59bb88bcf4-9jwdx user-container 2020-05-12 13:44:02,365 INFO  [org.acm.fun.SimpleFunctionChain] (executor-thread-2) *** configChain ***
funqy-knative-events-quickstart-v1-deployment-59bb88bcf4-9jwdx user-container 2020-05-12 13:44:02,394 INFO  [org.acm.fun.SimpleFunctionChain] (executor-thread-1) *** annotatedChain ***
funqy-knative-events-quickstart-v1-deployment-59bb88bcf4-9jwdx user-container 2020-05-12 13:44:02,466 INFO  [org.acm.fun.SimpleFunctionChain] (executor-thread-2) *** lastChainLink ***
funqy-knative-events-quickstart-v1-deployment-59bb88bcf4-9jwdx user-container 2020-05-12 13:44:02,467 INFO  [org.acm.fun.SimpleFunctionChain] (executor-thread-2) Start::defaultChain::configChain::annotatedChain::lastChainLink</code></pre>
</div>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. Todas las dependencias de este proyecto están disponible bajo la <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Licencia Apache Software 2.0</a> o una licencia compatible.<br /><br />Este sitio web fue construido con <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, está alojado en <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> y es completamente de código abierto. Si quieres mejorarlo, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>crea un fork de la página web</a> y muéstranos lo que tienes.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/about">Acerca&nbsp;de</a></li>
          
            <li><a href="/blog">Blog</a></li>
          
            <li><a href="/insights">Podcast</a></li>
          
            <li><a href="/events">Eventos</a></li>
          
            <li><a href="/newsletter">Newsletter</a></li>
          
            <li><a href="/publications">Publicaciones</a></li>
          
            <li><a href="/awards">Premios</a></li>
          
            <li><a href="/security">Política&nbsp;de&nbsp;seguridad</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Síguenos</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Obtener ayuda</span>
        <ul class="footer-links">
          
            <li><a href="/support">Soporte</a></li>
          
            <li><a href="/guides">Guías</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">Introducción</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">Discusiones</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Lista de correo de desarrollo</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus está hecho a base de proyectos comunitarios</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">Y muchos más...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
